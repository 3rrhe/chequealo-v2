CREATE TABLE department(
  department_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  name varchar(255) not null,
  description long,
  PRIMARY KEY (department_id)
);

CREATE TABLE cuser (
  cuser_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  user_name varchar(25) NOT NULL,
  role varchar(15) NOT NULL,
  password varchar(10) NOT NULL,
  email varchar(35) NOT NULL,
  apikey varchar(100),
  enabled number(1),
  created_at timestamp NOT NULL,
  updated_at timestamp NOT NULL,
  deleted_at timestamp,
  PRIMARY KEY (cuser_id)
);

CREATE TABLE user_oauth (
  user_oath_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  cuser_id number NOT NULL,
  provider varchar(50)  NOT NULL,
  identifier varchar(255),
  acces_token varchar(255),
  refresh_token varchar(255),
  PRIMARY KEY (user_oath_id),
  CONSTRAINT "FK_user_oauth.user_id"
    FOREIGN KEY (cuser_id)
      REFERENCES cuser(cuser_id)
);

CREATE TABLE schedule(
  schedule_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  income timestamp NOT NULL,
  lunch_start timestamp NOT NULL,
  lunch_end timestamp NOT NULL,
  output timestamp NOT NULL,
  PRIMARY KEY (schedule_id)
);

CREATE TABLE job_position(
  job_position_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  name varchar(255) NOT NULL,
  description long,
  department_id number NOT NULL,
  schedule_id number NOT NULL,
  PRIMARY KEY (job_position_id),
  CONSTRAINT "FK_job_position.schedule_id"
    FOREIGN KEY (schedule_id)
      REFERENCES schedule(schedule_id),
  CONSTRAINT "FK_job_position.department_id"
    FOREIGN KEY (department_id)
      REFERENCES department(department_id)
);

CREATE TABLE employee(
  employee_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  first_name varchar(255) NOT NULL,
  last_name varchar(255),
  address varchar(255),
  cuser_id number NOT NULL,
  job_position_id number NOT NULL,
  PRIMARY KEY (employee_id),
  CONSTRAINT "FK_employee.user_id"
    FOREIGN KEY (cuser_id)
      REFERENCES cuser(cuser_id),
  CONSTRAINT "FK_employee.job_position_id"
    FOREIGN KEY (job_position_id)
      REFERENCES job_position(job_position_id)
);

CREATE TABLE marking (
  marking_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  employee_id number NOT NULL,
  entry_at timestamp NOT NULL,
  departure_at timestamp,
  deleted_at timestamp,
  PRIMARY KEY (marking_id),
  CONSTRAINT "FK_marking.employee_id"
    FOREIGN KEY (employee_id)
      REFERENCES employee(employee_id)
);

CREATE TABLE delay(
  delay_id number GENERATED BY DEFAULT ON NULL AS IDENTITY,
  create_at timestamp NOT NULL,
  marking_id number NOT NULL,
  deleted_at timestamp,
  type varchar(50) NOT NULL,
  PRIMARY KEY (delay_id),
  CONSTRAINT "FK_delay.marking_id"
    FOREIGN KEY (marking_id)
      REFERENCES marking(marking_id)
);

INSERT INTO CUSER(user_name, role, password, email, apikey, enabled, created_at, updated_at, deleted_at) VALUES ('admin', 'ROLE_ADMIN', '826455', 'rroca@praga.ws', 'no-apikey', 1, LOCALTIMESTAMP(6), LOCALTIMESTAMP(6), null);
